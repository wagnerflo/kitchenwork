var navlinks = [
  {
    title: "Cocktails", folder: "cocktails", sections: [
      { entries: [
          { title: "Basics", file: "basics" }
        ]
      }, {
        title: "Ingredients", entries: [
          { title: "Basil Sweet & Sour",   file: "basil-sweet-sour" }
        ]
      }, { entries: [
          { separator: true }
        ]
      }, {
        title: "Aperol", entries: [
          { title: "Archangel",            file: "archangel" },
          { title: "Garden Party",         file: "garden-party" },
          { title: "Pretty in Pink",       file: "pretty-in-pink" }
        ]
      }, {
        title: "Brandy", entries: [
          { title: "Brandy Alexander",     file: "brandy-alexander" }
        ]
      }, {
        title: "Cachaça", entries: [
          { title: "Batida de Avocado",    file: "batida-de-avocado" },
          { title: "Gingergrass Mule",     file: "gingergrass-mule" },
          { title: "Thy-me-up",            file: "thymeup" }
        ]
      }, {
        title: "Campari", entries: [
          { title: "Baroness Collins",     file: "baroness-collins" }
        ]
      }, {
        title: "Gin", entries: [
          { title: "Archangel",            file: "archangel" },
          { title: "Baroness Collins",     file: "baroness-collins" },
          { title: "Garden Party",         file: "garden-party" },
          { title: "Lemon Gingerini",      file: "lemon-gingerini" },
          { title: "Pretty in Pink",       file: "pretty-in-pink" },
          { title: "Millionaire’s Mule",   file: "millionaires-mule" },
          { title: "Sloe Gin Fizz",        file: "sloe-gin-fizz" },
          { title: "Winter Warmer",        file: "winter-warmer" }
        ]
      }, {
        title: "Grand Marnier", entries: [
          { title: "Thy-me-up",            file: "thymeup" }
        ]
      }, {
        title: "Rum", entries: [
          { title: "Basilito",             file: "basilito" }
        ]
      }, {
        title: "Pisco", entries: [
          { title: "Pisco Sour",           file: "pisco-sour" }
        ]
      }, {
        title: "Sparkling wine", entries: [
          { title: "Millionaire’s Mule",   file: "millionaires-mule" }
        ]
      }, {
        title: "Wodka", entries: [
          { title: "Wasabi Martini",       file: "wasabi-martini" }
        ]
      }, {
        title: "Other", entries: [
          { title: "Grasshopper",          file: "grasshopper" }
        ]
      }, {
        title: "Non-alcoholic", entries: [
          { title: "Gunner",               file: "gunner" }
        ]
      }
    ]
  }, {
    title: "Eingemachtes", folder: "eingemachtes", sections: [{ entries: [
      { title: "Feine Salsa",                   file: "feine-salsa" },
      { title: "Hummus",                        file: "hummus" },
      { separator: true },
      { title: "Apfel/Kiwi/Bananen-Marmelade",  file: "akiba-marmelade" },
      { title: "Apfel/Maracuja/Zimt-Marmelade", file: "amazi-marmelade" },
      { title: "Geröstete Rhabarber/Erdbeer-Marmelade",
        file: "geroestete-rhabarber-erdbeer" },
      { title: "Matcha-Sahnecreme",             file: "matcha-sahne-creme" },
      { title: "Orangenmarmelade",              file: "orangen-marmelade" },
      { separator: true },
      { title: "Ingwersirup",                   file: "ingwersirup" }
    ] }]
  }, {
    title: "Gebäck", folder: "gebaeck", sections: [{ entries: [
      { title: "Theorie & Tipps", file: "theorie" },
      { separator: true },
      { title: "Ciabatta",                   file: "ciabatta" },
      { title: "Dinkelfoccacia",             file: "dinkelfoccacia" },
      { title: "Fladenbrot",                 file: "fladenbrot" },
      { title: "Knäckebrot",                 file: "knaeckebrot" },
      { title: "Präsidentenbaguettes",       file: "praesidentenbaguettes" },
      { title: "Quark/Dinkel-Kastenbrot",    file: "quarkdinkelkasten" },
      { separator: true },
      { title: "Cantucci morbidi toscani",   file: "cantucci" },
      { title: "Erdbeertorte",               file: "erdbeertorte" },
      { title: "Goldknödel",                 file: "goldknoedel" },
      { title: "Hefeteig für Blechkuchen",   file: "blechkuchen-hefeteig" },
      { title: "Muffins",                    file: "muffins" },
      { title: "Quittenkompottkuchen",       file: "quittenkompottkuchen" },
      { separator: true },
      { title: "Crêpe",                      file: "crepe" },
      { title: "Flammkuchen",                file: "flammkuchen" },
      { title: "Pancakes",                   file: "pancakes" },
      { title: "Pizza",                      file: "pizza" },
      { title: "Pfannkuchen",                file: "pfannkuchen" },
    ] }]
  }, {
    title: "Gerichte", folder: "gerichte", sections: [{ entries: [
      { title: "Bœuf Stroganoff",
        file: "boeuf-stroganoff" },
      { title: "Bolognese",
        file: "bolognese" },
      { title: "Jiǎozi",
        file: "jiaozi" },
      { title: "Lamm-Teriyaki mit Rosenkohl und Ingwer-Dip",
        file: "lamm-teriyaki-mit-rosenkohl" },
      { title: "Limetten/Ingwer Hühnchen",
        file: "limetten-ingwer-huehnchen" },
      { title: "Mediterraner Broccolisalat",
        file: "mediterraner-broccolisalat" },
      { title: "Murgh Saag",
        file: "murgh-saag" },
      { title: "Oyakodon",
        file: "oyakodon" },
      { title: "Scharf/fruchtiges Karottengemüse",
        file: "scharf-fruchtiges-karottengemuese" },
      { title: "Wirsing-Paprika Nudeln",
        file: "wirsing-paprika-nudeln" },
    ] }]
  }, {
    title: "Suppen", folder: "suppen", sections: [{ entries: [
      { title: "Broccolirahmsuppe",  file: "broccolirahm" },
      { title: "Gazpacho",           file: "gazpacho" },
      { title: "Lauchcremesuppe",    file: "lauchcreme" },
      { title: "Paprikacremesuppe",  file: "paprikacreme" },
      { title: "Scharfe Entensuppe", file: "scharfe-enten" },
    ] }]
  },
];

var navbar = $("#navbar");
var tmpl_navbar_links = Handlebars.compile($("#tmpl-navbar-links").html());
var tmpl_content = Handlebars.compile($("#tmpl-content").html());

navbar.append(tmpl_navbar_links({ navlinks: navlinks }));

$(window).on("hashchange", function(evt) {
  var path = location.hash.substr(1);
  if(!path)
    return;

  $.ajax({
    url: path + ".html",
    dataType: "html",
    success: function(data) {
      var items = path.split("/");

      $.each(navlinks, function(idx, heading) {
        if(items[0] != heading.folder)
          return;
        $.each(heading.sections, function(idx, section) {
          $.each(section.entries, function(idx, entry) {
            if(items[1] != entry.file)
              return;
            $("#content").html(
              tmpl_content({
                heading: heading.title,
                title: entry.title,
                content: data,
              })
            );
          });
        });
      });
    }
  });
});

$(window).trigger("hashchange");

/** Dropdown submenu support **/
$('.dropdown-menu a.dropdown-toggle').on('click', function(e) {
  var $el = $(this);
  var $parent = $(this).offsetParent(".dropdown-menu");
  if (!$(this).next().hasClass('show')) {
    $(this).parents('.dropdown-menu').first().find('.show').removeClass("show");
  }
  var $subMenu = $(this).next(".dropdown-menu");
  $subMenu.toggleClass('show');

  $(this).parent("li").toggleClass('show');

  $(this).parents('li.nav-item.dropdown.show').on('hidden.bs.dropdown', function (e) {
    $('.dropdown-menu .show').removeClass("show");
  });

  if (!$parent.parent().hasClass('navbar-nav')) {
    $el.next().css({ "top": $el[0].offsetTop, "left": $parent.outerWidth() - 4 });
  }

  return false;
});
